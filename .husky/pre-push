#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running Code Review & Quality Checks before push..."

# Run linting
echo "üìù Checking code style with ESLint..."
yarn lint:check || {
  echo "‚ùå ESLint failed. Please fix the errors before pushing."
  echo "üí° Run 'yarn lint' to auto-fix some issues."
  exit 1
}

# Check code formatting
echo "üé® Checking code formatting with Prettier..."
yarn format:check || {
  echo "‚ùå Code formatting check failed. Please format your code before pushing."
  echo "üí° Run 'yarn format' to auto-format your code."
  exit 1
}

# Run build to check for errors
echo "üèóÔ∏è  Building project to check for errors..."
yarn build || {
  echo "‚ùå Build failed. Please fix the errors before pushing."
  exit 1
}

# Check for console.log in production code (non-blocking warning)
echo "üîç Checking for console.log statements..."
if command -v grep > /dev/null 2>&1; then
  if grep -r "console\.log" src/ --exclude-dir=node_modules > /dev/null 2>&1; then
    echo "‚ö†Ô∏è  Warning: console.log found in code. Consider removing them in production."
    echo "üí° Files with console.log:"
    grep -r "console\.log" src/ --exclude-dir=node_modules -l || true
  fi
fi

# Check for debugger statements (blocking)
echo "üîç Checking for debugger statements..."
if command -v grep > /dev/null 2>&1; then
  if grep -r "debugger" src/ --exclude-dir=node_modules > /dev/null 2>&1; then
    echo "‚ùå Error: debugger statements found in code. Please remove them before pushing."
    grep -r "debugger" src/ --exclude-dir=node_modules -l || true
    exit 1
  fi
fi

echo "‚úÖ All Code Review & Quality Checks passed! Pushing to remote..."
