name: Code Review & Quality Checks

on:
  push:
    branches: [ main, develop, master ]
  pull_request:
    branches: [ main, develop, master ]

jobs:
  code-quality:
    name: Code Review & Quality Checks
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ðŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'yarn'

    - name: ðŸ“¥ Install dependencies
      run: yarn install --frozen-lockfile

    - name: ðŸ“ Run ESLint
      run: yarn lint:check
      continue-on-error: false

    - name: ðŸŽ¨ Check code formatting
      run: yarn format:check
      continue-on-error: false

    - name: ðŸ—ï¸  Run build
      run: yarn build
      continue-on-error: false

    - name: ðŸ” Check for console.log
      run: |
        if grep -r "console\.log" src/ --exclude-dir=node_modules; then
          echo "âš ï¸ Warning: console.log found in code. Consider removing them in production."
          echo "::warning::console.log statements found in code"
        fi

    - name: ðŸ” Check for debugger statements
      run: |
        if grep -r "debugger" src/ --exclude-dir=node_modules; then
          echo "âŒ Error: debugger statements found in code."
          echo "::error::debugger statements found in code"
          exit 1
        fi

    - name: ðŸ“¦ Check bundle size
      run: |
        yarn build
        SIZE=$(du -sh dist | cut -f1)
        echo "ðŸ“¦ Bundle size: $SIZE"
        echo "::notice::Bundle size: $SIZE"

    - name: ðŸ“Š Quality Report
      if: always()
      run: |
        echo "## ðŸ“Š Code Quality Report" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… ESLint: Passed" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Prettier: Passed" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Build: Passed" >> $GITHUB_STEP_SUMMARY
